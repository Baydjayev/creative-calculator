<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Creative Calculator</title>

  <!-- Google fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;500;700&family=Orbitron:wght@500;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg1: #0f172a; /* dark */
      --glass: rgba(255,255,255,0.08);
      --glass-2: rgba(255,255,255,0.06);
      --accent1: #6EE7B7;
      --accent2: #60A5FA;
      --accent3: #A78BFA;
      --neon: #00f0ff;
    }

    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,'Segoe UI',Roboto,"Helvetica Neue",Arial;}
    body{
      background: radial-gradient(1200px 600px at 10% 10%, rgba(96,165,250,0.08), transparent),
                  radial-gradient(1000px 500px at 90% 90%, rgba(167,139,250,0.06), transparent),
                  linear-gradient(180deg,var(--bg1), #071024 120%);
      overflow:hidden;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:32px;
      color:#e6eef8;
    }

    /* floating orbs */
    .orb {
      position:fixed;
      border-radius:50%;
      filter: blur(36px);
      opacity:0.35;
      pointer-events:none;
      mix-blend-mode: screen;
      animation: floatOrb 12s linear infinite;
    }
    .orb.o1{ width:420px;height:420px; background: linear-gradient(45deg, rgba(96,165,250,0.8), rgba(96,250,200,0.7)); left:-120px; top:-80px; animation-duration:18s; }
    .orb.o2{ width:320px;height:320px; background: linear-gradient(45deg, rgba(167,139,250,0.8), rgba(255,120,175,0.7)); right:-80px; bottom:-120px; animation-duration:20s; }
    @keyframes floatOrb {
      0%{ transform: translateY(0) translateX(0); }
      50%{ transform: translateY(30px) translateX(20px) rotate(8deg);}
      100%{ transform: translateY(0) translateX(0); }
    }

    /* main container */
    .wrap{
      width:100%;
      max-width:420px;
      position:relative;
      z-index:2;
    }

    .card {
      background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
      border-radius:20px;
      padding:20px;
      box-shadow: 0 10px 30px rgba(2,6,23,0.6), inset 0 1px 0 rgba(255,255,255,0.02);
      border:1px solid rgba(255,255,255,0.04);
      backdrop-filter: blur(8px) saturate(120%);
      overflow:hidden;
    }

    .header {
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom:14px;
    }

    .brand {
      display:flex;
      gap:12px;
      align-items:center;
    }
    .logo {
      width:46px;height:46px;border-radius:10px;
      background: linear-gradient(135deg,var(--accent2),var(--accent3));
      display:flex;align-items:center;justify-content:center;color:#011; font-weight:700;
      box-shadow: 0 6px 18px rgba(96,165,250,0.12);
      font-family: Orbitron, monospace;
    }
    .brand h1{font-size:16px;margin:0}
    .brand p{font-size:12px;margin:0;color:rgba(230,238,248,0.7)}

    .settings {
      display:flex;
      gap:8px;
      align-items:center;
      color:rgba(230,238,248,0.9);
      font-size:13px;
    }

    /* display */
    #displayWrap {
      position:relative;
      margin-bottom:18px;
    }
    #display {
      width:100%;
      height:78px;
      border-radius:12px;
      border:none;
      font-family:Orbitron, monospace;
      font-size:28px;
      padding:12px 18px;
      text-align:right;
      color:var(--neon);
      background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
      box-shadow: inset 0 6px 24px rgba(0,0,0,0.6), 0 6px 30px rgba(2,6,23,0.6);
      text-shadow: 0 0 8px rgba(0,240,255,0.12), 0 2px 0 rgba(0,0,0,0.5);
      overflow:hidden;
      white-space:nowrap;
      text-overflow:ellipsis;
    }
    #subDisplay {
      position:absolute;
      left:14px;
      top:8px;
      font-size:12px;
      color:rgba(230,238,248,0.5);
      pointer-events:none;
    }

    /* grid buttons */
    .keys {
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap:12px;
    }

    button.key {
      height:60px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,0.06);
      background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
      color: #e6eef8;
      font-size:16px;
      font-weight:600;
      cursor:pointer;
      transition: transform .18s ease, box-shadow .18s ease, background .18s ease;
      box-shadow: 0 6px 18px rgba(2,6,23,0.45);
      display:flex;
      align-items:center;
      justify-content:center;
      position:relative;
      overflow:hidden;
    }

    /* hover & active */
    button.key:hover{
      transform: translateY(-6px);
      box-shadow: 0 14px 30px rgba(96,165,250,0.15);
      background: linear-gradient(135deg, rgba(96,165,250,0.18), rgba(167,139,250,0.12));
      color:#001;
    }
    button.key:active{
      transform: translateY(0);
      box-shadow: 0 6px 12px rgba(2,6,23,0.6);
    }

    .key.op { background: linear-gradient(135deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); }
    .key.eq { background: linear-gradient(135deg, var(--accent1), var(--accent2)); color:#012; font-weight:800; font-size:18px; }

    .key.span2{ grid-column: span 2; }

    /* small label under title */
    .hint { font-size:12px; color:rgba(230,238,248,0.45); margin-bottom:10px; }

    /* footer small */
    .footer { margin-top:12px; text-align:center; font-size:12px; color:rgba(230,238,248,0.45); }

    /* responsive */
    @media (max-width:480px){
      .wrap{ padding:0 8px; }
      #display{ height:64px; font-size:22px; }
      button.key{ height:56px; font-size:15px; border-radius:10px; }
      .logo{ width:44px; height:44px; font-size:14px; }
    }

    /* small 'pulse' animation when result updates */
    .flash {
      animation: flash 420ms ease;
    }
    @keyframes flash {
      0% { transform: scale(0.98); filter: brightness(0.9); }
      50% { transform: scale(1.02); filter: brightness(1.1); }
      100% { transform: scale(1); filter: brightness(1); }
    }

    /* error shake */
    .shake { animation: shake 420ms linear; }
    @keyframes shake {
      0% { transform: translateX(0); }
      20% { transform: translateX(-6px); }
      40% { transform: translateX(6px); }
      60% { transform: translateX(-4px); }
      80% { transform: translateX(4px); }
      100% { transform: translateX(0); }
    }

    /* tiny tooltip for keys (optional) */
    .tooltip {
      position:absolute; bottom:8px; left:50%; transform:translateX(-50%); font-size:11px;
      background:rgba(0,0,0,0.45); padding:6px 8px;border-radius:8px; color:#fff; display:none;
    }

  </style>
</head>
<body>

  <!-- decorative orbs -->
  <div class="orb o1"></div>
  <div class="orb o2"></div>

  <div class="wrap">
    <div class="card" role="application" aria-label="Creative calculator">
      <div class="header">
        <div class="brand">
          <div class="logo">C</div>
          <div>
            <h1 style="margin:0">Creative Calc</h1>
            <p style="margin:0">Keng funksiyali veb-kalkulyator</p>
          </div>
        </div>

        <div class="settings">
          <div id="modeLabel" title="Keyboard: Enter = =, Backspace = ⌫">Kalkulyator</div>
        </div>
      </div>

      <div id="displayWrap">
        <div id="subDisplay"></div>
        <input id="display" aria-label="Calculator display" readonly value="">
      </div>

      <div class="hint">Funktsiyalar: √, x², 1/x, %, π, e, sin, cos, tan, log, ln. Klaviatura bilan ham ishlaydi.</div>

      <div class="keys" role="grid">
        <!-- row 1 -->
        <button class="key" data-val="(">(</button>
        <button class="key" data-val=")">)</button>
        <button class="key" data-action="back">⌫</button>
        <button class="key op" data-val="/">÷</button>

        <!-- row 2 -->
        <button class="key" data-val="7">7</button>
        <button class="key" data-val="8">8</button>
        <button class="key" data-val="9">9</button>
        <button class="key op" data-val="*">×</button>

        <!-- row 3 -->
        <button class="key" data-val="4">4</button>
        <button class="key" data-val="5">5</button>
        <button class="key" data-val="6">6</button>
        <button class="key op" data-val="-">−</button>

        <!-- row 4 -->
        <button class="key" data-val="1">1</button>
        <button class="key" data-val="2">2</button>
        <button class="key" data-val="3">3</button>
        <button class="key op" data-val="+">+</button>

        <!-- row 5 -->
        <button class="key span2" data-val="0">0</button>
        <button class="key" data-val=".">.</button>
        <button class="key eq" data-action="calc">=</button>

        <!-- row 6 extra functions -->
        <button class="key" data-action="clear">C</button>
        <button class="key" data-action="percent">%</button>
        <button class="key" data-action="inverse">1/x</button>
        <button class="key" data-action="sqrt">√</button>

        <!-- row 7 -->
        <button class="key" data-action="pow2">x²</button>
        <button class="key" data-val="Math.PI">π</button>
        <button class="key" data-val="Math.E">e</button>
        <button class="key" data-val="^" title="use ^ for power">^</button>

        <!-- row 8 scientific -->
        <button class="key" data-val="Math.sin(">sin</button>
        <button class="key" data-val="Math.cos(">cos</button>
        <button class="key" data-val="Math.tan(">tan</button>
        <button class="key" data-val="Math.log10(">log</button>

        <!-- row 9 -->
        <button class="key" data-val="Math.log(">ln</button>
        <button class="key" data-action="ans">ANS</button>
        <button class="key" data-action="clearAll">AC</button>
        <button class="key op" data-action="theme">✨</button>
      </div>

      <div class="footer">© Sizning Ismingiz — Creative Calculator</div>
    </div>
  </div>

  <script>
    // ========= Basic calculator behavior =========
    const display = document.getElementById('display');
    const subDisplay = document.getElementById('subDisplay');
    const keys = document.querySelectorAll('button.key');
    let lastAnswer = '';
    let themeState = 0;

    // Allowed characters for basic safety:
    const ALLOWED_RE = /^[0-9+\-*/().%^, MathPIEansincoegtlnr]*$/i;

    // Map caret ^ to power operator ** during preprocess
    function preprocessExpression(raw){
      if(!raw) return '';
      let s = raw;

      // Replace special tokens
      s = s.replace(/π/g, 'Math.PI');
      s = s.replace(/pi\b/gi, 'Math.PI');
      s = s.replace(/e\b/gi, 'Math.E');

      // Replace caret ^ with ** but only where appropriate
      s = s.replace(/\^/g, '**');

      // If user used percent at end of number: '50%' -> '(50/100)'
      s = s.replace(/(\d+(\.\d+)?)%/g, '($1/100)');

      // Remove accidental commas
      s = s.replace(/,/g, '.');

      return s;
    }

    // Safe evaluate using Function. We limit by only allowing certain characters in original input.
    function safeEvaluate(input) {
      // Quick sanity: block suspicious substrings
      // Allow "Math." and function names listed above; disallow letters that form identifiers other than allowed tokens.
      // For more security, use a proper expression parser. This is adequate for demo.
      const raw = input + '';
      // disallow letters other than a safe subset: Math, sin, cos, tan, log, log10, PI, E, ans
      const safeAllowed = /^[0-9+\-*/().%^, \tMathsinco tanlog10PIEans]*$/i;
      // Simple check: remove 'Math.' to test for letters
      const cleaned = raw.replace(/Math\./g, '');
      if(!safeAllowed.test(cleaned)) {
        throw new Error('Invalid expression');
      }

      const expr = preprocessExpression(raw);

      // final defensive replace: disallow "constructor", "window", "document"
      if(/window|document|constructor|prototype/i.test(expr)) throw new Error('Unsafe expression');

      // Evaluate
      // Use Function to evaluate expression; returns number or throws.
      return Function('"use strict"; return (' + expr + ')')();
    }

    function updateDisplayFlash(){
      display.classList.remove('flash');
      void display.offsetWidth;
      display.classList.add('flash');
    }

    function updateDisplayShake(){
      display.classList.remove('shake');
      void display.offsetWidth;
      display.classList.add('shake');
    }

    // Button handlers
    keys.forEach(k => {
      k.addEventListener('click', (e) => {
        const val = k.getAttribute('data-val');
        const action = k.getAttribute('data-action');

        if(val){
          // Append value text (some values like Math.PI included)
          display.value += val;
          subDisplay.textContent = '';
        } else if(action){
          handleAction(action);
        }
      });
    });

    function handleAction(action){
      switch(action){
        case 'clear': display.value = ''; subDisplay.textContent = ''; break;
        case 'clearAll': display.value = ''; subDisplay.textContent = ''; lastAnswer=''; break;
        case 'back': display.value = display.value.slice(0,-1); break;
        case 'calc': doCalculate(); break;
        case 'percent': display.value += '%'; break;
        case 'sqrt': display.value += 'Math.sqrt('; break;
        case 'inverse': display.value = '1/(' + display.value + ')'; break;
        case 'pow2': display.value += '**2'; break;
        case 'ans': display.value += lastAnswer; break;
        case 'theme': toggleTheme(); break;
        default: break;
      }
    }

    function doCalculate(){
      try {
        const expr = display.value;
        const result = safeEvaluate(expr);
        if(result === undefined || result === null || Number.isNaN(result)) throw new Error('Error');
        // pretty formatting: limit decimals
        let out = result;
        if(Number.isFinite(result) && Math.abs(result) < 1e12){
          out = Math.round((result + Number.EPSILON) * 1e12)/1e12; // round to 12 decimal significance
          // remove trailing zeros
          out = parseFloat(out.toString());
        }
        lastAnswer = out.toString();
        subDisplay.textContent = expr;
        display.value = out;
        updateDisplayFlash();
      } catch(err){
        subDisplay.textContent = err.message || 'Error';
        display.value = 'Error';
        updateDisplayShake();
      }
    }

    // keyboard support
    window.addEventListener('keydown', (e) => {
      // allow numbers and operators
      if((e.key >= '0' && e.key <= '9') || "+-*/().".includes(e.key)) {
        display.value += e.key;
      } else if(e.key === 'Enter' || e.key === '=') {
        e.preventDefault();
        doCalculate();
      } else if(e.key === 'Backspace') {
        display.value = display.value.slice(0,-1);
      } else if(e.key === 'Escape') {
        display.value = '';
        subDisplay.textContent = '';
      } else if(e.key === '%'){
        display.value += '%';
      } else if(e.key === '^'){
        display.value += '^';
      } else if(e.key.toLowerCase() === 'p'){ // quick insert pi with 'p' (optional)
        // only when ctrl/alt not pressed
        if(!e.ctrlKey && !e.metaKey && !e.altKey) display.value += 'Math.PI';
      }
    });

    // theme toggle (small visual change)
    function toggleTheme(){
      themeState = (themeState + 1) % 3;
      if(themeState === 0){
        document.documentElement.style.setProperty('--accent1','#6EE7B7');
        document.documentElement.style.setProperty('--accent2','#60A5FA');
        document.documentElement.style.setProperty('--accent3','#A78BFA');
      } else if(themeState === 1){
        document.documentElement.style.setProperty('--accent1','#FFD166');
        document.documentElement.style.setProperty('--accent2','#FF6B6B');
        document.documentElement.style.setProperty('--accent3','#845EC2');
      } else {
        document.documentElement.style.setProperty('--accent1','#4DFFB5');
        document.documentElement.style.setProperty('--accent2','#00F5D4');
        document.documentElement.style.setProperty('--accent3','#00B4D8');
      }
      // small pulse to indicate change
      document.querySelector('.card').classList.add('flash');
      setTimeout(()=>document.querySelector('.card').classList.remove('flash'),420);
    }

    // small mobile-friendly tap animation
    keys.forEach(k => {
      k.addEventListener('touchstart', () => k.classList.add('active'));
      k.addEventListener('touchend', () => k.classList.remove('active'));
    });

    // optional: start with example
    display.value = '';

    // ===== optional: gentle floating particles canvas (subtle) =====
    // small canvas overlay for tiny particles
    (function initParticles(){
      const cvs = document.createElement('canvas');
      cvs.style.position='fixed';
      cvs.style.left=0; cvs.style.top=0; cvs.style.zIndex=1;
      cvs.style.pointerEvents='none';
      document.body.appendChild(cvs);
      const ctx = cvs.getContext('2d');
      let w,h, particles=[];
      function resize(){ w = cvs.width = innerWidth; h = cvs.height = innerHeight; }
      window.addEventListener('resize', resize);
      resize();
      function rand(min,max){ return Math.random()*(max-min)+min;}
      for(let i=0;i<26;i++){
        particles.push({
          x: rand(0,w), y: rand(0,h),
          r: rand(0.6,2.2),
          vx: rand(-0.2,0.4), vy: rand(-0.2,0.2),
          alpha: rand(0.05,0.18)
        });
      }
      function step(){
        ctx.clearRect(0,0,w,h);
        for(let p of particles){
          p.x += p.vx;
          p.y += p.vy;
          if(p.x > w+20) p.x = -20;
          if(p.x < -20) p.x = w+20;
          if(p.y > h+20) p.y = -20;
          if(p.y < -20) p.y = h+20;
          ctx.beginPath();
          ctx.fillStyle = 'rgba(255,255,255,'+p.alpha+')';
          ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
          ctx.fill();
        }
        requestAnimationFrame(step);
      }
      requestAnimationFrame(step);
    })();

  </script>
</body>
</html>
